machine:
  php:
    version: 5.5.11
  node:
    version: 0.10.28
  services:
     - rabbitmq-server
  hosts:
    local.symfony2-standard-template: 127.0.0.1

#database:
#  override:
#    - mysql -u ubuntu symfony2_standard_template < src/craft/storage/backups/craft.sql

dependencies:
  pre:
    - mysql -u ubuntu -e "Create database symfony2_standard_template"
    - cp config/php/php.ini ~/.phpenv/versions/$(phpenv global)/etc/conf.d/
  post:
    - cp config/apache/dist.vhost.conf /etc/apache2/sites-available
    - a2ensite dist.vhost.conf
    - cp config/apache/src.vhost.conf /etc/apache2/sites-available
    - a2ensite src.vhost.conf
    - a2enmod rewrite
    - a2enmod headers
    - sudo service apache2 restart

test:
  pre:
    - bower install
    - grunt build --target=dist

deployment:
  production:
    branch: master
    commands:
      - git add ./dist -A
      - git commit -m "Build by Newbot via CircleCI" --author="newism-newbot <team@newism.com.au>"
      - git push origin master
#      - cap production deploy
