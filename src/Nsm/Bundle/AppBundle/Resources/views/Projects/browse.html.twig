{% extends 'NsmAppBundle::layout.html.twig' %}
{% form_theme search_form 'NsmFormBundle:Form:form_table_layout.html.twig' %}

{% set entities = pager.getCurrentPageResults %}

{% block content -%}

    <h1>Projects</h1>

    <ul>
        <li>
            <a href="{{ path('project_add') }}">
                Add Project
            </a>
        </li>
        <li>
            <a href="#filter">
                Search
            </a>
        </li>
    </ul>

    <div class="DataGrid" data-widget="dataGrid" data-data-grid-options="{{
        {
            filter: {},
            perPage: {},
            page: 1,
            orderBy: {
                id: "desc"
            }
        } | json_encode(24)
    }}">

        <div class="DataGrid-filter">
            {{ form(search_form, {"attr": {"class": "Form", "novalidate": "novalidate"}}) }}
        </div>
        <div class="DataGrid-results">
            <table data-widget="dataTable" data-data-table-options="{{ {query: app.request.query.all} | json_encode(24) }}">
                <caption>
                    Showing {{ pager.currentPageFirstResultOffset }} - {{ pager.currentPageLastResultOffset }} of {{ pager.totalResultCount }} results
                </caption>
                <thead>
                    <tr>
                        <th data-attribute="id">Id</th>
                        <th data-attribute="title">Title</th>
                        <th data-attribute="createdAt">Created At</th>
                        <th data-attribute="taskCount">Tasks</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% for entity in entities %}
                    <tr>
                        <td><a href="{{ path('project_read', { 'id': entity.id }) }}">{{ entity.id }}</a></td>
                        <td>{{ entity.title }}</td>
                        <td>{{ entity.createdAt|localizeddate('full', 'long') }}</td>
                        <td>{{ entity.tasks.count }}</td>
                        <td>
                        <ul>
                            <li>
                                <a href="{{ path('task_add', { 'projectId': entity.id }) }}">create task</a>
                            </li>
                            <li>
                                <a href="{{ path('project_read', { 'id': entity.id }) }}">show</a>
                            </li>
                            <li>
                                <a href="{{ path('project_edit', { 'id': entity.id }) }}">edit</a>
                            </li>
                            <li>
                                <a href="{{ path('project_destroy', { 'id': entity.id }) }}">destroy</a>
                            </li>
                        </ul>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>


    {% endblock %}
